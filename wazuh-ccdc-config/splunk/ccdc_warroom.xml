<!--
  CCDC War Room Dashboard for Splunk
  
  Import via: Splunk Web > Dashboards > Create New Dashboard > Source Editor
  Paste this entire XML content.
  
  Or save as:
    /opt/splunk/etc/apps/wazuh_ccdc/local/data/ui/views/ccdc_warroom.xml
  
  Then create:
    /opt/splunk/etc/apps/wazuh_ccdc/local/data/ui/nav/default.xml
  With content:
    <nav><view name="ccdc_warroom" default="true"/></nav>
-->
<dashboard>
  <label>CCDC War Room</label>
  <description>Real-time Wazuh alerts for CCDC competition defense</description>

  <!-- Row 1: Key metrics -->
  <row>
    <panel>
      <single>
        <title>Critical Alerts (Level 12+)</title>
        <search>
          <query>index=wazuh rule.level>=12 earliest=-15m | stats count</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorBy">value</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[0,5]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>CCDC Rule Hits (Last 15m)</title>
        <search>
          <query>index=wazuh rule.groups="ccdc*" earliest=-15m | stats count</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorBy">value</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[0,3]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>FIM Changes (Last 15m)</title>
        <search>
          <query>index=wazuh syscheck.event=* earliest=-15m | stats count</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
      </single>
    </panel>
    <panel>
      <single>
        <title>Auth Failures (Last 15m)</title>
        <search>
          <query>index=wazuh rule.groups="authentication_failed" earliest=-15m | stats count</query>
          <earliest>-15m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="colorBy">value</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[0,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <single>
        <title>Active Agents</title>
        <search>
          <query>index=wazuh earliest=-5m | stats dc(agent.name) as agents</query>
          <earliest>-5m</earliest>
          <latest>now</latest>
          <refresh>60s</refresh>
        </search>
      </single>
    </panel>
  </row>

  <!-- Row 2: High severity alerts timeline + top attacked hosts -->
  <row>
    <panel>
      <chart>
        <title>Alert Timeline (Level 10+)</title>
        <search>
          <query>index=wazuh rule.level>=10 | timechart span=2m count by agent.name</query>
          <earliest>-60m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
      </chart>
    </panel>
    <panel>
      <chart>
        <title>Top Attacked Hosts</title>
        <search>
          <query>index=wazuh rule.level>=8 | stats count by agent.name | sort -count</query>
          <earliest>-60m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="charting.chart">bar</option>
      </chart>
    </panel>
  </row>

  <!-- Row 3: CCDC-specific detections -->
  <row>
    <panel>
      <table>
        <title>CCDC Rule Alerts (Webshells, Persistence, Disruption)</title>
        <search>
          <query>index=wazuh rule.groups="ccdc*"
| table _time agent.name rule.id rule.description rule.level syscheck.path
| sort -_time</query>
          <earliest>-4h</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
      </table>
    </panel>
  </row>

  <!-- Row 4: File integrity changes + brute force sources -->
  <row>
    <panel>
      <table>
        <title>Recent File Changes</title>
        <search>
          <query>index=wazuh syscheck.event=*
| table _time agent.name syscheck.event syscheck.path syscheck.sha256_after
| sort -_time</query>
          <earliest>-60m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <table>
        <title>Top Brute Force Sources</title>
        <search>
          <query>index=wazuh (rule.groups="authentication_failed" OR rule.groups="ccdc_bruteforce")
| stats count by srcip agent.name
| sort -count</query>
          <earliest>-60m</earliest>
          <latest>now</latest>
          <refresh>30s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <!-- Row 5: Vulnerability overview -->
  <row>
    <panel>
      <table>
        <title>Critical/High Vulnerabilities Detected</title>
        <search>
          <query>index=wazuh rule.groups="vulnerability-detector" (data.vulnerability.severity="Critical" OR data.vulnerability.severity="High")
| stats count by agent.name data.vulnerability.cve data.vulnerability.severity data.vulnerability.package.name
| sort data.vulnerability.severity -count</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
          <refresh>300s</refresh>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
      </table>
    </panel>
  </row>

  <!-- Row 6: Live alert feed -->
  <row>
    <panel>
      <event>
        <title>Live Alert Feed (Level 8+)</title>
        <search>
          <query>index=wazuh rule.level>=8 | sort -_time</query>
          <earliest>-30m</earliest>
          <latest>now</latest>
          <refresh>15s</refresh>
        </search>
        <option name="count">20</option>
        <option name="list.drilldown">none</option>
      </event>
    </panel>
  </row>

</dashboard>
